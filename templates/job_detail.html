{% extends "base.html" %}
{% block title %}{{ job.title }}{% endblock %}
{% block content %}
<a href="{{ url_for('dashboard') }}" class="text-muted text-decoration-none small">
  <i class="fas fa-arrow-left me-1"></i>Back to Jobs
</a>

<div class="row mt-3">
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm rounded-3 p-4 mb-4">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h4 class="fw-bold mb-1">{{ job.title }}</h4>
          <p class="text-muted mb-0">
            <i class="fas fa-building me-1"></i>{{ job.company or job.employer_name }}
            &nbsp;|&nbsp;
            <i class="fas fa-map-marker-alt me-1"></i>{{ job.location }}
          </p>
        </div>
        <span class="badge bg-primary rounded-pill fs-6">{{ job.job_type }}</span>
      </div>
      {% if job.salary %}
      <div class="alert alert-success py-2 mb-3">
        <i class="fas fa-rupee-sign me-1"></i><strong>{{ job.salary }}</strong>
      </div>
      {% endif %}
      <h6 class="fw-bold">Job Description</h6>
      <p style="white-space:pre-wrap">{{ job.description }}</p>
      <hr>
      <p class="text-muted small mb-0">
        Posted on: {{ job.created_at[:10] }}&nbsp;|&nbsp;
        Contact: <a href="mailto:{{ job.employer_email }}">{{ job.employer_email }}</a>
      </p>
    </div>
  </div>

  <div class="col-lg-4">
    {% if session.role == 'jobseeker' %}
      {% if already_applied %}
      <div class="card border-0 shadow-sm rounded-3 p-4 text-center">
        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
        <h5 class="fw-bold">Application Submitted</h5>
        <p class="text-muted small">You've already applied for this position.</p>
        <a href="{{ url_for('my_applications') }}" class="btn btn-outline-success w-100">
          View My Applications
        </a>
      </div>
      {% else %}
      <div class="card border-0 shadow-sm rounded-3 p-4">
        <h5 class="fw-bold mb-3">Apply for this Job</h5>
        <form method="POST" action="{{ url_for('apply_job', job_id=job.id) }}">
          <div class="mb-3">
            <label class="form-label fw-semibold">Cover Letter</label>
            <textarea name="cover_letter" class="form-control" rows="5"
                      placeholder="Tell the employer why you're a great fit..."></textarea>
          </div>
          <button type="submit" class="btn btn-primary w-100 py-2">
            <i class="fas fa-paper-plane me-2"></i>Submit Application
          </button>
        </form>
      </div>
      {% endif %}
    {% endif %}
  </div>
</div>
{% endblock %}